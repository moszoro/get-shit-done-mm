---
phase: 01-constitution-foundation
plan: 03
type: execute
wave: 3
depends_on: ["01-02"]
files_modified:
  - bin/install.js
  - commands/gsd/new-project.md
  - src/constitution/init.js
autonomous: true

must_haves:
  truths:
    - "Global CONSTITUTION.md installed to ~/.claude/get-shit-done/ during npm install"
    - "Project CONSTITUTION.md created in .planning/ during /gsd:new-project"
    - "Constitution loader accessible to GSD commands/workflows"
    - "Installation creates constitution from template"
  artifacts:
    - path: "bin/install.js"
      provides: "Installs global CONSTITUTION.md during setup"
      contains: "CONSTITUTION.md"
      min_lines: 150
    - path: "commands/gsd/new-project.md"
      provides: "Creates project CONSTITUTION.md during initialization"
      contains: "CONSTITUTION.md"
    - path: "src/constitution/init.js"
      provides: "Constitution initialization helper"
      exports: ["initGlobalConstitution", "initProjectConstitution"]
      min_lines: 40
  key_links:
    - from: "bin/install.js"
      to: "get-shit-done/templates/constitution/global-constitution.md"
      via: "copyWithPathReplacement or similar copy logic"
      pattern: "global-constitution\\.md"
    - from: "commands/gsd/new-project.md"
      to: "get-shit-done/templates/constitution/project-constitution.md"
      via: "Bash copy command or Task creation"
      pattern: "project-constitution\\.md"
    - from: "src/constitution/loader.js"
      to: "System initialization"
      via: "require and instantiate ConstitutionLoader"
      pattern: "ConstitutionLoader"
---

<objective>
Integrate constitution system into GSD installation and project initialization workflows.

Purpose: Wire constitution templates and loader into existing GSD commands so constitutions are automatically created during setup. Enables constitutional enforcement in later phases.

Output: Constitution files created during install/init, loader accessible to GSD system.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/maciejmoszoro/Projects/GSD-with-constitution/get-shit-done-mm/.planning/PROJECT.md
@/Users/maciejmoszoro/Projects/GSD-with-constitution/get-shit-done-mm/.planning/ROADMAP.md
@/Users/maciejmoszoro/Projects/GSD-with-constitution/get-shit-done-mm/.planning/phases/01-constitution-foundation/01-CONTEXT.md
@/Users/maciejmoszoro/Projects/GSD-with-constitution/get-shit-done-mm/.planning/codebase/STRUCTURE.md
@/Users/maciejmoszoro/Projects/GSD-with-constitution/get-shit-done-mm/.planning/codebase/CONVENTIONS.md

Prior work:
@/Users/maciejmoszoro/Projects/GSD-with-constitution/get-shit-done-mm/.planning/phases/01-constitution-foundation/01-01-SUMMARY.md
@/Users/maciejmoszoro/Projects/GSD-with-constitution/get-shit-done-mm/.planning/phases/01-constitution-foundation/01-02-SUMMARY.md

Existing files to modify:
@/Users/maciejmoszoro/Projects/GSD-with-constitution/get-shit-done-mm/bin/install.js
@/Users/maciejmoszoro/Projects/GSD-with-constitution/get-shit-done-mm/commands/gsd/new-project.md
</context>

<tasks>

<task type="auto">
  <name>Create constitution initialization helper</name>
  <files>src/constitution/init.js</files>
  <action>
Create `src/constitution/init.js` with helper functions for constitution file creation.

Functions:
1. `initGlobalConstitution(targetDir)` - Copies global template to target directory
2. `initProjectConstitution(targetDir)` - Copies project template to target directory

Implementation:
- Use Node.js fs module (sync methods appropriate for setup operations)
- Read template from `get-shit-done/templates/constitution/*.md`
- Replace placeholder values (lastUpdated with current date)
- Write to target location
- Use path.join for all path operations (cross-platform)
- Return success/failure status

Example:
```javascript
function initGlobalConstitution(targetDir) {
  const templatePath = path.join(__dirname, '..', '..', 'get-shit-done', 'templates', 'constitution', 'global-constitution.md');
  const targetPath = path.join(targetDir, 'CONSTITUTION.md');

  // Read template
  let content = fs.readFileSync(templatePath, 'utf8');

  // Replace placeholders
  const now = new Date().toISOString().split('T')[0];
  content = content.replace(/lastUpdated:.*/, `lastUpdated: ${now}`);

  // Write to target
  fs.writeFileSync(targetPath, content, 'utf8');

  return targetPath;
}
```

Export both functions for use in install.js and new-project workflow.

Follow CONVENTIONS.md: CommonJS modules, camelCase function names, 2-space indent.
  </action>
  <verify>
File exists at `src/constitution/init.js`.
Exports `initGlobalConstitution` and `initProjectConstitution` functions.
Functions use path.join for all path operations.
Functions replace lastUpdated placeholder with current date.
  </verify>
  <done>
Constitution initialization helpers ready for integration.
Functions handle template copying with placeholder replacement.
Cross-platform path handling implemented.
  </done>
</task>

<task type="auto">
  <name>Integrate into install script</name>
  <files>bin/install.js</files>
  <action>
Update `bin/install.js` to install global CONSTITUTION.md during GSD setup.

Add after existing file copy operations (look for where templates/workflows/commands are copied):

1. Require the init helper:
```javascript
const { initGlobalConstitution } = require('../src/constitution/init');
```

2. Create constitution directory in target:
```javascript
const constitutionDir = path.join(homeDir, '.claude', 'get-shit-done');
if (!fs.existsSync(constitutionDir)) {
  fs.mkdirSync(constitutionDir, { recursive: true });
}
```

3. Initialize global constitution:
```javascript
const constitutionPath = initGlobalConstitution(constitutionDir);
console.log(`  ${green}✓${reset} Global constitution: ${constitutionPath}`);
```

Integration point: After existing GSD files are copied, before "Installation complete" message.

Match existing code style: ANSI color codes (green, reset), checkmark symbols, consistent indentation.

DO NOT modify existing installation logic - only add constitution initialization.
  </action>
  <verify>
`bin/install.js` imports `initGlobalConstitution`.
Constitution initialization called during install process.
Success message printed with checkmark.
Code follows existing install.js style (ANSI colors, error handling).
Integration test: Run install.js in test mode or dry-run, verify initGlobalConstitution called with correct path.
  </verify>
  <done>
Global constitution automatically installed during `npm install -g get-shit-done-cc`.
Installation log confirms constitution file creation.
Integration preserves existing install behavior.
  </done>
</task>

<task type="auto">
  <name>Integrate into new-project command</name>
  <files>commands/gsd/new-project.md</files>
  <action>
Update `/gsd:new-project` command to create project CONSTITUTION.md during initialization.

Find the section where .planning/ directory structure is created (after PROJECT.md, ROADMAP.md, STATE.md creation).

Add bash command to copy project constitution template:

```bash
# Create project constitution
cp ~/.claude/get-shit-done/templates/constitution/project-constitution.md .planning/CONSTITUTION.md
sed -i '' "s/lastUpdated:.*/lastUpdated: $(date +%Y-%m-%d)/" .planning/CONSTITUTION.md
echo "✓ Project constitution created"
```

Alternative approach using Node.js (if command uses Task tool for file operations):
Reference `src/constitution/init.js` via Task tool to call `initProjectConstitution(path.join(process.cwd(), '.planning'))`.

Integration point: After `.planning/` directory created, alongside other initialization files.

Match command style: Imperative voice, technical precision, no filler words.

DO NOT modify existing project initialization steps - only add constitution creation.
  </action>
  <verify>
`commands/gsd/new-project.md` includes constitution creation step.
Project CONSTITUTION.md created in .planning/ directory.
lastUpdated field populated with current date.
Command documentation updated if necessary.
Integration test: Run new-project command in test directory, verify CONSTITUTION.md created at .planning/CONSTITUTION.md with expected content.
  </verify>
  <done>
Project constitution automatically created during `/gsd:new-project`.
Constitution file appears in .planning/ alongside PROJECT.md, ROADMAP.md.
Integration preserves existing new-project workflow.
  </done>
</task>

</tasks>

<verification>
End-to-end integration verification:

1. Install verification:
```bash
# Run install script (in test mode or actual)
node bin/install.js

# Verify global constitution created
ls ~/.claude/get-shit-done/CONSTITUTION.md
grep "version: 1.0.0" ~/.claude/get-shit-done/CONSTITUTION.md
grep "TDD-01" ~/.claude/get-shit-done/CONSTITUTION.md
```

2. New-project verification:
```bash
# Create test directory and run new-project
mkdir /tmp/test-gsd-project && cd /tmp/test-gsd-project

# Run new-project command (simulated or actual)
# Verify project constitution created
ls .planning/CONSTITUTION.md
grep "version: 1.0.0" .planning/CONSTITUTION.md
```

3. Loader integration verification:
```bash
# Test that loader can access created constitutions
node -e "const {ConstitutionLoader} = require('./src/constitution/loader'); const loader = new ConstitutionLoader(); console.log(loader.load());"
```

Both constitutions have version 1.0.0 and current lastUpdated date.
Templates include TDD-01 rule (global) and override examples (project).
ConstitutionLoader accessible via require('src/constitution/loader').
Functions from init.js actually called and produce expected files.
</verification>

<success_criteria>
- [ ] Constitution init helper created with template copy functions
- [ ] Install script creates global CONSTITUTION.md during setup
- [ ] New-project command creates project CONSTITUTION.md during init
- [ ] Both constitutions have version 1.0.0
- [ ] lastUpdated fields populated with current date
- [ ] Integration preserves existing install/init workflows
- [ ] End-to-end test confirms files created at expected paths
- [ ] End-to-end test confirms loader can read created constitutions
- [ ] Code committed with message following project conventions
</success_criteria>

<output>
After completion, create `/Users/maciejmoszoro/Projects/GSD-with-constitution/get-shit-done-mm/.planning/phases/01-constitution-foundation/01-03-SUMMARY.md`
</output>
